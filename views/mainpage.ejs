<!DOCTYPE html>
<html ng-app="Chatapp">
<head>
  <meta charset="UTF-8">
  <title>Main page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
  <!-- semantic UI -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/semantic.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.6/semantic.js"></script>

  <!-- angular  -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.0-rc.2/angular.js"></script>

</head>

<body ng-controller="ChatCtrl">
  <!-- navigation bar -->
  <div class="ui top attached icon menu">
    <div class="header item">
      Our Company
    </div>
    <div class="ui dropdown right icon item ">
      <i class="icon setting large teal "></i>
      <div class="menu">
        <div class="item">
          <a href="/profile" >Profile</a>
        </div>
        <div class="divider"></div>
        <div class="item">
          <a href="/logout" >Log out</a>
        </div>
      </div>
    </div>
  </div>
  <!-- grid view -->
  <div class="ui attached grid ">

    <div class="eleven wide column">
      <div class="ui top icon menu">
        <div class="right menu">
          <a class="item"><i class="icon record large teal "></i></a>
          <a class="item"><i class="icon call large teal "></i></a>
        </div>
      </div>
    </div>

    <div class="five wide column">
      <!-- some part -->
      <div class="ui teal inverted two top attached item menu large">
        <a class="item " data-tab="first">Friend</a>
        <a class="item active" data-tab="second">Online User</a>
      </div>

      <div class="ui bottom attached tab segment " data-tab="first">
        <div class="ui very relaxed large list selection ">
          <div class="item">
            <div class="right floated content">
              <div class="ui button">Add</div>
            </div>
            <img class="ui avatar image" src="">
            <div class="content">
              <a class="header">Rachel</a>
            </div>
          </div>
        </div>
      </div>

      <div class="ui bottom attached tab segment active" data-tab="second">
        <div class="ui very relaxed large list selection" id = "OnlineUsers" ng-repeat="user in OnlineUser">
          <div class="item">
            <div class="right floated content">
              <div class="ui button">Add</div>
            </div>
            <img class="ui avatar image" src="">
            <div class="content">
              <a class="header">{{user}}</a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    $('.menu .item').tab();
    $('.ui.dropdown').dropdown();

    var current_user = '<%=user.local.email %>'; console.log(current_user);
    var socket = io();
    
    socket.emit('user_send_status_online', current_user);
    var Chatapp = angular.module("Chatapp", []);
      Chatapp.factory('socket', function ($rootScope) {
        var socket = io.connect();
        return {
          on: function (eventName, callback) {
            socket.on(eventName, function () {
              var args = arguments;
              $rootScope.$apply(function () {
                callback.apply(socket, args);
              });
            });
          },
          emit: function (eventName, data, callback) {
            socket.emit(eventName, data, function () {
              var args = arguments;
              $rootScope.$apply(function () {
                if (callback) {
                  callback.apply(socket, args);
                }
              });
            })
          }
        };
      });

      Chatapp.controller("ChatCtrl", function ($scope, $rootScope, socket) {
        $scope.OnlineUser = [];
        socket.on('server_send_online_user', function(data){
            $scope.OnlineUser = data.onlineUsers;
        });
      });

  </script>
</body>
</html>
